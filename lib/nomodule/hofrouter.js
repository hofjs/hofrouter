(()=>{var _=class{constructor(e,t,s){this.execute=e,this.bindVariableNames=t,this.template=s}},h=class extends HTMLElement{constructor(e="div"){super();this._observersForBindVariable=new Map,this._observerExpressions=new Map,this._properties={},this._locals={},this._allBindVariables=null,this._allBindExpressions={},this._renderIteration=-1,this._listTemplate=null,this._listData=[],this._listIt="",this._listStart=0,this.PROPS_FILTER=t=>t.charAt(0)!="_"&&t!=t.toUpperCase()&&t!="constructor"&&t!="render",this.REFERENCED_BIND_VARIABLE_NAMES_REGEX=new RegExp("([a-zA-Z_$][\\w]+\\.[\\w\\.]+)","g"),this.DERIVED_PROPERTY_SIGNATURE_REGEX=new RegExp("^function *\\(\\)"),this._tagName=e,this._shadow=this.attachShadow({mode:"open"})}connectedCallback(){this._root=document.createElement(this._tagName),this._shadow.appendChild(this._root),this.render()}useAutoProps(){this._forEachPropertyOfObjectAndPrototype((e,t)=>{let s=t[e];e.startsWith("event-")&&(e=e.substring(6),delete t[e]),e=="construct"&&typeof s=="function"?s.call(this):Object.defineProperty(this,e,{get:function(){return this.getProperty(e,s)},set:function(r){let i=this.getProperty(e,s);this._callBindVariableBeforeChangedHook(this,e,r,i)&&(this.setProperty(e,r),this._callBindVariableAfterChangedHook(this,e,r,i))},enumerable:!0,configurable:!0})})}setProperty(e,t){let s=this._properties[e];(typeof s=="object"||typeof t=="object"||s!=t||t.lastActionMethod)&&(this._properties[e]=t,this._allBindVariables&&(this._allBindVariables[e]=t),this._updatePropertyObservers([e,t])),this._allBindVariables&&this._makeBindVariableObservable(e)}getProperty(e,t){var s,r;return this._allBindVariables?this._allBindVariables[e]:(r=(s=this._properties[e])!==null&&s!==void 0?s:this.getAttribute(e))!==null&&r!==void 0?r:t}_hasAlreadyRendered(){return this._root.textContent!=""}renderContent(e,t=void 0){this._renderFull(e,t)}renderList(e,t,s=void 0){let r=t.toString(),i=r.substring(r.indexOf("(")+1,r.indexOf(")"));if(typeof e!="string"){this._listData=e,this._listIt=i,this._listTemplate=t,this._listStart=this._root.childNodes.length,(typeof s=="undefined"||s==null)&&(s={});for(let n of this._listData)s[this._listIt]=n,this._renderFull(t,s)}}_calculateProperties(){let e={};this._forEachPropertyOfObjectAndPrototype((t,s)=>e[t]=s[t]),this._allBindVariables=e}_forEachPropertyOfObjectAndPrototype(e){for(let s of Object.getOwnPropertyNames(this).filter(this.PROPS_FILTER))e(s,this);let t=Object.getPrototypeOf(this);for(let s of Object.getOwnPropertyNames(t).filter(this.PROPS_FILTER))e(s,t)}_convertToTemplateExpression(e){let t=e.toString(),s=t.indexOf("`");return s>0&&(t=t.substring(s+1,t.length-1)),t}_parseHTML(e,t){let s=this._convertToTemplateExpression(e);this._allBindVariables==null&&this._calculateProperties();let r=this._allBindVariables,[i,n]=this._calculateTemplateAndBindVariableNames(s,r,t);return this._calculateBindings(i,n),[new DOMParser().parseFromString(i,"text/html").body.childNodes,r,n]}_makeBindVariableObservable(e){for(let t of this._allBindExpressions[e])this._makeBindVariableStructureObservable(e,t)}_makeBindVariableStructureObservable(e,t){let s=this._allBindVariables[e],r=t.split("."),i=s,n=e;for(let o=0;o<r.length;o++){let a=r[o];if(n+=`.${r[o]}`,typeof i=="undefined")return;typeof i=="object"&&(Array.isArray(i)?this._makeArrayObservable(i,e):this._makeObjectObservable(i,a,e,n)),i=i[r[o]]}}_callBindVariableBeforeChangedHook(e,t,s,r){let i=`${t}BeforeChanged`;if(e[i]){let n=e[i](s,r);return!(typeof n!="undefined"&&n==!1)}return!0}_callBindVariableAfterChangedHook(e,t,s,r){let i=`${t}AfterChanged`;e[i]&&e[i](s,r)}_callBindVariableBeforePropertyChangedHook(e,t,s,r,i){let n=`${t}BeforePropertyChanged`;if(e[n]){let o=e[n](s,r,i);return!(typeof o!="undefined"&&o==!1)}return!0}_callBindVariableAfterPropertyChangedHook(e,t,s,r,i){let n=`${t}AfterPropertyChanged`;e[n]&&e[n](s,r,i)}_makeObjectObservable(e,t,s,r){let i=e[t],n=this;this._registerNewObserver(e,t)&&Object.defineProperty(e,t,{get:function(){return i}.bind(n),set:function(o){let a=i;n._callBindVariableBeforeChangedHook(e,t,o,a)&&(i=o,e._observers.forEach((c,u)=>c.forEach(()=>{let d=u.getProperty(s,void 0);if(d){if(!u._callBindVariableBeforePropertyChangedHook(n,s,r,o,a))return;d.lastActionMethod="SET",d.lastActionPropertyPath=r,u.setProperty(s,d),u._callBindVariableAfterPropertyChangedHook(n,s,r,o,a),d.lastActionMethod=null,d.lastActionPropertyPath=null}})),n._callBindVariableAfterChangedHook(e,t,i,a))}.bind(n),enumerable:!0,configurable:!0})}_makeArrayObservable(e,t){this._registerNewObserver(e,t)&&(e._emit=function(s,r){return r.length==0?this.lastActionMethod="DELETE":s==null?this.lastActionMethod="ADD":r.length==1&&(this.lastActionMethod="EDIT"),this.lastActionIndex=s??this.length-1,this._observers.forEach((i,n)=>i.forEach(o=>n.setProperty(o,this))),this.lastActionMethod=null,this.lastActionIndex=null,this},e.push=function(...s){return Array.prototype.push.call(this,...s),e._emit(null,s),e.length},e.splice=function(s,r,...i){let n=Array.prototype.splice.call(this,s,r,...i);return r<=1&&e._emit(s,i),n},e.edit=function(s,r){return this.splice(s,1,r)},e.delete=function(s){return this.splice(s,1)})}_registerNewObserver(e,t){return e._observers||(e._observers=new Map),e._observers.has(this)||e._observers.set(this,[]),e._observers.get(this).includes(t)?!1:(e._observers.get(this).push(t),!0)}_calculateBindings(e,t){for(let s of t){let r=new RegExp(`(${s})((\\.[\\w]+)+)`,"g");this._allBindExpressions[s]=[];for(let[,,i]of e.matchAll(r)){let n=i.substring(1);this._allBindExpressions[s].includes(n)||this._allBindExpressions[s].push(n)}this._makeBindVariableObservable(s)}}_renderFull(e,t){this._locals=t;let[s,r,i]=this._parseHTML(e,t),n=this._root.childNodes.length;for(;s.length>0;)this._root.appendChild(s[0]);for(let o=n;o<this._root.childNodes.length;o++)this._processElementBinding(this._root.childNodes[o],r,i)}_renderUpdate(e){if(this._listTemplate!=null){this._locals[this._listIt]=this._listData[e.lastActionIndex];let[t,s,r]=this._parseHTML(this._listTemplate,{[this._listIt]:this._listData[e.lastActionIndex]});e.lastActionMethod=="ADD"?(this._root.childNodes[e.lastActionIndex]?this._root.insertBefore(t[0],this._root.childNodes[this._listStart+e.lastActionIndex-1].nextSibling):this._root.appendChild(t[0]),this._processElementBinding(this._root.childNodes[this._listStart+e.lastActionIndex],s,r)):e.lastActionMethod=="EDIT"?(this._root.replaceChild(t[0],this._root.childNodes[this._listStart+e.lastActionIndex]),this._processElementBinding(this._root.childNodes[this._listStart+e.lastActionIndex],s,r)):e.lastActionMethod=="DELETE"&&this._root.childNodes[this._listStart+e.lastActionIndex].remove()}}_makeDerivedVariablesObservable(e,t,s){if(!this.DERIVED_PROPERTY_SIGNATURE_REGEX.test(t))return s;let r="||null";for(let[i]of t.matchAll(this.REFERENCED_BIND_VARIABLE_NAMES_REGEX))r+="||"+i;return s.replaceAll(`${e}`,`(${e}()${r})`)}_calculateTemplateAndBindVariableNames(e,t,s){this._renderIteration++;let r=Object.keys(t);if(s)for(let[n,o]of Object.entries(s)){let a=n+this._renderIteration;t[a]=o,r.push(a);let c=new RegExp(`(${n.replaceAll("$","\\$")})([^=-])`,"g");for(let[u,,d]of e.matchAll(c))e=e.replace(u,`${a}${d}`);e=this._makeDerivedVariablesObservable(a,o.toString(),e)}let i=new RegExp("(this[\\w$.]*\\.[\\w$]+)([(]?)","g");for(let[,n,o]of e.matchAll(i)){if(o=="(")continue;let a=n.indexOf(".")+1,c=new Function("return "+n).call(t).toString().replaceAll("this.",n.substring(a,n.indexOf(".",a)+1));e=this._makeDerivedVariablesObservable(n,c,e)}return[e,r]}_processElementBinding(e,t,s){if("attributes"in e&&Array.from(e.attributes).forEach(r=>{r.nodeValue.includes("${")&&this._processBindingExpression(e,t,s,r.nodeName,r.nodeValue)}),"data"in e&&e.data.includes("${")&&this._processBindingExpression(e,t,s,"data",e.data),"childNodes"in e)for(let r of Array.from(e.childNodes))this._processElementBinding(r,t,s);"_hasAlreadyRendered"in e&&!e._hasAlreadyRendered()&&e.render()}_processBindingExpression(e,t,s,r,i){let n=this._buildCallableExpression(r,i,s);this._observerExpressions.has(e)||this._observerExpressions.set(e,new Map),this._observerExpressions.get(e).set(r,n),this._registerElementAttributeAsObserverForBindVariables(e,r,t,n.bindVariableNames);let o=this._getBindVariableValues(n.bindVariableNames);e[r]=n.execute(...o)}_buildCallableExpression(e,t,s){e=="data"||t.lastIndexOf("${")>0||t.lastIndexOf("}")<t.length-1?t="`"+t+"`":t=t.replaceAll("${","").replaceAll("}","");let r=[];for(let i of s)t.includes(i)&&r.push(i);return new _(new Function(...r,"return "+t).bind(this),r,t)}_registerElementAttributeAsObserverForBindVariables(e,t,s,r){for(let i of r){this._observersForBindVariable.has(i)||this._observersForBindVariable.set(i,new Map);let n=this._observersForBindVariable.get(i);n.has(e)||n.set(e,[]),s[i].bind&&(s[i]=s[i].bind(this)),n.get(e).push(t)}}_getBindVariableValues(e){let t=[];for(let s of e)t.push(this._allBindVariables[s]);return t}_updatePropertyObservers(e){let[t,s]=e;if(this._observersForBindVariable.has(t))for(let[r,i]of this._observersForBindVariable.get(t).entries())for(let n of i){let o=this._observerExpressions.get(r).get(n),a=this._getBindVariableValues(o.bindVariableNames),c=o.execute(...a);(!s.lastActionPropertyPath||o.template&&o.template.includes(s.lastActionPropertyPath))&&(c.lastActionMethod?r instanceof h&&r._renderUpdate(c):r[n]=c)}}};var l=class{static _setup(){l.initialized=!0,window.onload=()=>{l.processRoute(document.location.href,!0,!1),document.body.addEventListener("click",function(e){let t=e.path[0];t.nodeName=="A"&&(e.preventDefault(),l.processRoute(t.attributes[0].nodeValue))})},window.onpopstate=e=>{l.processRoute(e.state.url,!1,!1)}}static _buildRoute(e,t,s){var i;return{url:s.url,urlRegex:r(s.url),component:s.component,params:s.params,redirect:s.redirect,aliases:s.aliases,aliasesRegexes:(i=s.aliases)==null?void 0:i.map(n=>r(n)),renderElementParent:e,renderElementId:t};function r(n){return n=="*"?new RegExp("^.*$"):new RegExp("^"+n.replace(/:([a-zA-Z0-9]+)/,"(?<$1>[\\w-]+)")+"(\\?(?<$routeQuery>.*))?$")}}static configRoutes(e,t,s){l.initialized||l._setup();for(let[r,i]of Object.entries(s)){let n=l._buildRoute(e,t,i);i.url=="*"?l.defaultRoute=n:l.routes[r]=n}}static _findCurrentView(e){for(let t of Array.from(e.children))if(t.style&&t.style.display!="none")return t;return null}static _findNextView(e,t){for(let s of Array.from(e.children))if(s instanceof h&&s.getAttribute("router-url")==t.url)return s;return null}static _updateView(e,t,s){for(let i in t.params)e[i]=t.params[i];let r={url:t.url,params:{},query:""};for(let i in s)if(i=="$routeQuery"){if(typeof s[i]!="undefined"){for(let n of s[i].split("&")){let o=n.split("=");o.length==2&&(r.params[o[0]]=o[1])}r.query=s[i]}}else e[i]=s[i];l.current=r,e.setAttribute("router-url",t.url)}static _loadView(e,t,s){let r=new t.component;return r.style.display="none",l._updateView(r,t,s),e.appendChild(r),r}static _callBeforeRoutingHook(e,t,s){if(e!=null&&e.beforeRouting){let r=e.beforeRouting(t,s);if(typeof r!="undefined"&&r==!1)return!1}return!0}static _callAfterRoutingHook(e,t,s){e!=null&&e.afterRouting&&e.afterRouting(t,s)}static _resolveRouterUrl(e){let t=e.indexOf("("),s=e.indexOf(")"),r=t==-1?e.substring(7):e.substring(7,t),i=t==-1?"":e.substring(t+1,s);if(r=="back")return l.back(),null;if(r=="forward")return l.forward(),null;if(r=="go")return l.go(parseInt(i)),null;if(r=="push")return l.push(i),null;if(r=="replace")return l.replace(i),null;let n=l.routes[r].url,o="?";if(i)for(let a of i.split(",")){let[c,u]=a.trim().split("=");n.includes(`:${c}`)?n=n.replace(`:${c}`,u):o+=`${c}=${u}&`}return o=o.substring(0,o.length-1),n+=o,n}static _matchRoute(e,t,s,r){var n,o,a;if(e.startsWith("router:")&&(e=l._resolveRouterUrl(e),e==null))return!0;let i=(o=t.urlRegex.exec(e))!=null?o:(n=t.aliasesRegexes)==null?void 0:n.map(c=>c.exec(e)).find(c=>c!=null);if(i!=null){if(t.redirect)return!0;let c=t.renderElementParent.getElementById(t.renderElementId),u=l._findCurrentView(c),d=u==null?void 0:u.getAttribute("router-url"),g=i.groups,p=(a=l._findNextView(c,t))!=null?a:l._loadView(c,t,g);return l._callBeforeRoutingHook(u,e,d),l._callBeforeRoutingHook(p,e,d),u&&(u.style.display="none"),p.style.display="",l._updateView(p,t,g),s&&(r?history.pushState({url:e},"",e):history.replaceState({url:e},"",e)),l._callAfterRoutingHook(u,e,d),l._callAfterRoutingHook(p,e,d),!0}return!1}static processRoute(e,t=!0,s=!0){for(let r of Object.values(l.routes))if(l._matchRoute(e,r,t,s)){r.redirect&&l.processRoute(r.redirect,t,s);return}if(l.defaultRoute&&l._matchRoute(e,l.defaultRoute,t,s)){l.defaultRoute.redirect&&l.processRoute(l.defaultRoute.redirect,t,s);return}throw Error(`No matching route definition to resolve url ${e}!`)}static back(){history.back()}static forward(){history.forward()}static go(e){history.go(e)}static push(e){l.processRoute(e,!0,!0)}static replace(e){l.processRoute(e,!0,!1)}},f=l;f.initialized=!1,f.routes={},f.defaultRoute=null,f.current=null;window.HofRouter=f;})();
